<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>NetSync</title><link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet"><link rel = "stylesheet" href="style.css"></head><body><div class="container"><div class="header"><div class="username"><span class="username-text">USERNAME</span><button class="edit-username">Edit</button></div><div class="connection-status status-disconnected">Disconnected</div></div><div class="main-content"><div class="video-container"><video controls crossorigin="anonymous"></video><track kind="subtitles" label="English" srclang="en" default><div class="video-message" style="display:none;"></div></div><div class="controls"><input type="file" accept="video/*" id="videoFile" style="display:none"><input type="file" accept=".vtt,.srt" id="subtitleFile" style="display:none"><button class="btn" onclick="document.getElementById('videoFile').click()">Select Video</button><button class="btn" onclick="document.getElementById('subtitleFile').click()">Select Subtitles</button><button class="btn" id="connectBtn">Create Room</button><button class="btn" id="disconnectBtn" style="display:none">Disconnect</button><button class="btn" id="joinBtn">Join Room</button><div class="connection-code-container" style="display:none"><div class="connection-code"></div><button class="copy-btn">Copy</button></div><input type="text" placeholder="Enter room code..." class="connection-code" id="joinInput" style="display:none"><div class="connected-users"><h3>Connected Users</h3><ul class="user-list"></ul></div><div class="host-file" style="display:none"><div>Required video:</div><span class="required-filename"></span></div></div></div><div class="stats"><div>Bandwidth<span id="bandwidth">0 B/s</span></div><div>Total Data<span id="totalData">0 B</span></div><div>Room State<span id="roomState">-</span></div><div>Connected<span id="connectedCount">0</span></div></div></div><script>const USERNAMES=['Choom','Netrunner','Psycho','Nomad','Fixer','VoodoBoy','Ripper','Silverhand'];let ws=null;let isHost=false;let roomCode=localStorage.getItem('roomCode');let totalBytes=0;let lastBytesReceived=0;let lastVideoState={playing:false,time:0};let requiredFileName=null;let username=localStorage.getItem('username');let videoSource=localStorage.getItem('videoSource');let subtitleSource=localStorage.getItem('subtitleSource');const video=document.querySelector('video');const track=document.querySelector('track');if(videoSource){video.src=videoSource}if(subtitleSource){track.src=subtitleSource;video.textTracks[0].mode='showing'}if(!username){username=USERNAMES[Math.floor(Math.random()*USERNAMES.length)]+Math.floor(Math.random()*100);localStorage.setItem('username',username)}document.querySelector('.username-text').textContent=username;document.querySelector('.edit-username').addEventListener('click',()=>{const newUsername=prompt('Enter new username:',username);if(newUsername){username=newUsername;localStorage.setItem('username',username);document.querySelector('.username-text').textContent=username;if(ws){ws.send(JSON.stringify({type:'updateUsername',username:newUsername}))}}});const videoFile=document.getElementById('videoFile');const subtitleFile=document.getElementById('subtitleFile');const userList=document.querySelector('.user-list');const joinBtn=document.getElementById('joinBtn');const disconnectBtn=document.getElementById('disconnectBtn');const videoMessage=document.querySelector('.video-message');const copyBtn=document.querySelector('.copy-btn');videoFile.addEventListener('change',(e)=>{const file=e.target.files[0];if(file){if(requiredFileName&&!isHost){if(file.name!==requiredFileName){videoMessage.textContent=`Please select the correct file: ${requiredFileName}`;videoMessage.style.display='block';return}videoMessage.style.display='none';document.querySelector('.connection-status').className='connection-status status-connected';document.querySelector('.connection-status').textContent='Ready to Watch'}const videoURL=URL.createObjectURL(file);video.src=videoURL;localStorage.setItem('videoSource',videoURL);if(ws&&isHost){ws.send(JSON.stringify({type:'videoSelected',filename:file.name}))}}});subtitleFile.addEventListener('change',(e)=>{const file=e.target.files[0];if(file){const subtitleURL=URL.createObjectURL(file);track.src=subtitleURL;localStorage.setItem('subtitleSource',subtitleURL);video.textTracks[0].mode='showing'}});copyBtn.addEventListener('click',()=>{const code=document.querySelector('.connection-code').textContent;navigator.clipboard.writeText(code).then(()=>{copyBtn.textContent='Copied!';setTimeout(()=>copyBtn.textContent='Copy',2000)})});let ignoreEvents=false;video.addEventListener('play',()=>{if(!ignoreEvents&&ws){ws.send(JSON.stringify({type:'videoControl',action:'play',time:video.currentTime}))}ignoreEvents=false});video.addEventListener('pause',()=>{if(!ignoreEvents&&ws){ws.send(JSON.stringify({type:'videoControl',action:'pause',time:video.currentTime}))}ignoreEvents=false});video.addEventListener('seeked',()=>{if(!ignoreEvents&&ws){ws.send(JSON.stringify({type:'videoControl',action:'seek',time:video.currentTime}))}ignoreEvents=false});function updateRoomState(state){document.getElementById('roomState').textContent=state}function connectAsHost(){ws=new WebSocket('wss://netsync3-977231zi.b4a.run/');ws.onopen=()=>{ws.send(JSON.stringify({type:'create',username}));isHost=true;document.querySelector('.connection-status').className='connection-status status-connected';document.querySelector('.connection-status').textContent=`Connected (Host)`;document.getElementById('connectBtn').style.display='none';disconnectBtn.style.display='block';joinBtn.style.display='none'};ws.onmessage=handleMessage;ws.onclose=()=>{resetConnection()}}document.getElementById('connectBtn').addEventListener('click',()=>{if(!ws){connectAsHost()}});disconnectBtn.addEventListener('click',()=>{if(ws){localStorage.removeItem('roomCode');ws.close();resetConnection()}});joinBtn.addEventListener('click',()=>{document.getElementById('joinInput').style.display='block';joinBtn.style.display='none'});window.addEventListener('beforeunload',()=>{if(ws){ws.close()}});function handleMessage(event){totalBytes+=event.data.length;const data=JSON.parse(event.data);switch(data.type){case'created':roomCode=data.roomCode;localStorage.setItem('roomCode',roomCode);document.querySelector('.connection-code-container').style.display='block';document.querySelector('.connection-code').textContent=roomCode;break;case'joined':if(!isHost){document.querySelector('.connection-status').className='connection-status status-waiting';disconnectBtn.style.display='block';if(data.filename){requiredFileName=data.filename;document.querySelector('.host-file').style.display='block';document.querySelector('.required-filename').textContent=data.filename;videoMessage.textContent=`Host is playing: ${data.filename}\nPlease select the same file to watch together`;videoMessage.style.display='block'}}break;case'userList':updateUserList(data.users);break;case'videoControl':handleVideoControl(data);break;case'videoUpdate':requiredFileName=data.filename;document.querySelector('.host-file').style.display='block';document.querySelector('.required-filename').textContent=data.filename;if(!isHost){videoMessage.textContent=`Host is playing: ${data.filename}\nPlease select the same file to watch together`;videoMessage.style.display='block'}break;case'hostLeft':ws.close();alert('Host has left the room');break}}function handleVideoControl(data){ignoreEvents=true;if(data.action==='play'){video.currentTime=data.time;video.play();updateRoomState('playing')}else if(data.action==='pause'){video.currentTime=data.time;video.pause();updateRoomState('paused')}else if(data.action==='seek'){video.currentTime=data.time}}function updateUserList(users){userList.innerHTML='';users.forEach(user=>{const li=document.createElement('li');li.textContent=user;userList.appendChild(li)});document.getElementById('connectedCount').textContent=users.length}function resetConnection(){document.querySelector('.connection-status').className='connection-status status-disconnected';document.querySelector('.connection-status').textContent='Disconnected';document.getElementById('connectBtn').style.display='block';document.getElementById('connectBtn').textContent='Create Room';disconnectBtn.style.display='none';document.querySelector('.connection-code-container').style.display='none';joinBtn.style.display='block';document.getElementById('joinInput').style.display='none';document.querySelector('.host-file').style.display='none';videoMessage.style.display='none';ws=null;isHost=false;roomCode=null;requiredFileName=null;updateUserList([])}document.getElementById('joinInput').addEventListener('keypress',(e)=>{if(e.key==='Enter'){const code=e.target.value.trim();if(code){connectAsClient(code)}}});function connectAsClient(code){ws=new WebSocket('wss://netsync3-977231zi.b4a.run/');ws.onopen=()=>{ws.send(JSON.stringify({type:'join',roomCode:code,username}));localStorage.setItem('roomCode',code);document.querySelector('.connection-status').className='connection-status status-connected';document.querySelector('.connection-status').textContent='Connected (Viewer)';document.getElementById('joinInput').style.display='none';disconnectBtn.style.display='block'};ws.onmessage=handleMessage;ws.onclose=()=>{localStorage.removeItem('roomCode');resetConnection()}}if(roomCode){if(isHost){connectAsHost()}else{connectAsClient(roomCode)}}setInterval(()=>{const bytesReceived=totalBytes-lastBytesReceived;lastBytesReceived=totalBytes;document.getElementById('bandwidth').textContent=formatBytes(bytesReceived)+'/s';document.getElementById('bandwidth').textContent=formatBytes(bytesReceived)+'/s';document.getElementById('totalData').textContent=formatBytes(totalBytes)},1000);function formatBytes(bytes){if(bytes===0)return'0 B';const k=1024;const sizes=['B','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i]}</script></body></html>